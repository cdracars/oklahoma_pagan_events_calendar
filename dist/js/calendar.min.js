document.addEventListener("DOMContentLoaded",function(){initCalendar();function initCalendar(){const calendar=createCalendar();const calendarTypes=["Site","Astrological","Central","North-East","North-West","Online","South-Central","South-East","South-West"];const filterContainer=document.querySelector(".calendar-filter");const dropdown=buildCalendarFilterDropdown(calendarTypes);filterContainer.appendChild(dropdown);document.getElementById("calendarFilter").addEventListener("change",updateCalendarDisplay);setupNavigationButtons(calendar);fetchEvents().then(data=>{let events=data;updateCalendarDisplay()});function createCalendar(){const calendarEl=document.getElementById("calendar");return new tui.Calendar(calendarEl,{defaultView:"month",taskView:true,scheduleView:true,useDetailPopup:true})}function buildCalendarFilterDropdown(calendarTypes){const dropdown=document.createElement("select");dropdown.id="calendarFilter";const allOption=createOption("","All");dropdown.appendChild(allOption);calendarTypes.forEach(type=>{const calendarOption=createOption(type,type);dropdown.appendChild(calendarOption)});function createOption(value,text){const option=document.createElement("option");option.value=value;option.textContent=text;return option}return dropdown}function setupNavigationButtons(calendar){const todayButton=document.querySelector(".today");const prevButton=document.querySelector(".prev");const nextButton=document.querySelector(".next");const range=document.querySelector(".navbar--range");todayButton.addEventListener("click",()=>updateCalendarDisplay("today"));prevButton.addEventListener("click",()=>updateCalendarDisplay("prev"));nextButton.addEventListener("click",()=>updateCalendarDisplay("next"));function updateNavbarRange(){const viewType="month";const tzStart=calendar.getDateRangeStart();const tzEnd=calendar.getDateRangeEnd();const start=tzStart.toDate();const end=tzEnd.toDate();const middle=new Date(start.getTime()+(end.getTime()-start.getTime())/2);const rangeText=moment(middle).format("YYYY-MM");range.textContent=rangeText}return{todayButton:todayButton,prevButton:prevButton,nextButton:nextButton,updateNavbarRange:updateNavbarRange}}function updateCalendarDisplay(action=null){if(action==="today"){calendar.today()}else if(action==="prev"){calendar.prev()}else if(action==="next"){calendar.next()}const selectedCalendarType=document.getElementById("calendarFilter").value;const filteredEvents=events.filter(event=>!selectedCalendarType||event.raw.calendar===selectedCalendarType);calendar.clear();calendar.createEvents(filteredEvents);const{updateNavbarRange}=setupNavigationButtons(calendar);updateNavbarRange()}async function fetchEvents(targetCalendarType){try{const response=await fetch("data/calendar_events.json");const data=await response.json();return data.items.filter(event=>!targetCalendarType||event.calendar===targetCalendarType).map(event=>({id:event.id,calendarId:"1",title:event.summary,category:"time",start:event.start.dateTime||event.start.date,end:event.end.dateTime||event.end.date,color:"#fff",backgroundColor:event.color,raw:{calender:event.calendar}}))}catch(error){console.error("Error fetching calendar events:",error);return[]}}}});